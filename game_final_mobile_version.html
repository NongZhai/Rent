<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>租屋定金收據 預覽與下載</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: #f0f0f0;
      padding: 2rem;
    }
    #pdf-content {
      background: white;
      padding: 2rem;
      max-width: 700px;
      margin: auto;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #00C300;
      margin-bottom: 2rem;
    }
    .section {
      margin-bottom: 1rem;
    }
    .label {
      font-weight: bold;
      display: inline-block;
      width: 130px;
    }
    .signature {
      margin-top: 2rem;
    }
    .signature img {
      max-width: 300px;
      border: 1px solid #ccc;
      margin-top: 0.5rem;
    }
    .download {
      text-align: center;
      margin-top: 2rem;
    }
    button {
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      background-color: #00C300;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    button:hover {
      background-color: #009a00;
    }
  </style>
</head>
<body>

  <div id="pdf-content">
    <h2>租屋定金收據</h2>

    <div class="section"><span class="label">出租人：</span><span id="name"></span></div>
    <div class="section"><span class="label">租賃地址：</span><span id="addr"></span></div>
    <div class="section"><span class="label">租金：</span><span id="rent"></span> 元</div>
    <div class="section"><span class="label">訂金：</span><span id="deposit"></span> 元</div>
    <div class="section"><span class="label">保留至：</span><span id="reserve_date"></span></div>
    <div class="section"><span class="label">備註：</span><span id="tenant_note"></span></div>
    <div class="section"><span class="label">承租人姓名：</span><span id="tenant_name"></span></div>
    <div class="section"><span class="label">聯絡電話：</span><span id="tenant_phone"></span></div>
    <div class="section"><span class="label">電子信箱：</span><span id="tenant_email"></span></div>

    <div class="signature">
      <div class="label">簽名：</div>
      <img id="signature-img" alt="簽名圖">
    </div>
  </div>

  <div class="download">
    <button onclick="downloadPDF()">下載 PDF</button>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const fields = [
      'name', 'addr', 'rent', 'deposit', 'reserve_date',
      'tenant_note', 'tenant_name', 'tenant_phone', 'tenant_email', 'signature'
    ];

    fields.forEach(field => {
      const el = document.getElementById(field);
      if (el && params.get(field)) {
        if (field === 'signature') {
          el.src = decodeURIComponent(params.get(field));
        } else {
          el.textContent = decodeURIComponent(params.get(field));
        }
      }
    });

    function downloadPDF() {
      const content = document.getElementById('pdf-content');
      html2canvas(content, { scale: 2 }).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        const imgWidth = 210;
        const imgHeight = canvas.height * imgWidth / canvas.width;

        pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);

        const today = new Date();
        const dateStr = `${today.getFullYear()}${(today.getMonth()+1).toString().padStart(2, '0')}${today.getDate().toString().padStart(2, '0')}`;
        const fileName = `租屋定金收據_${params.get('tenant_name') || '租客'}_${dateStr}.pdf`;

        pdf.save(fileName);
      });
    }
  </script>
</body>
</html>

